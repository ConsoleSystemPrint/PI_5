# SMTP Email 

Этот программа для отправки электронных писем с использованием SMTP. Можно отправлять письма с вложениями.

## Настройка

### Шаг 1: Установите зависимости

Для работы программы вам нужно установить Python 3.6 или новее. Далее установите необходимые зависимости:

```bash
pip install configparser
```

### Шаг 2: Настройка конфигурационного файла

Создайте файл `config.ini` в корневой директории проекта со следующим содержимым:

```ini
[smtp]
server = smtp.server.example.com
port = 465
username = username
password = password

[email]
from = email@example.com
to = email@example.com
subject = Тема
body_file = body.txt
attachments = attachment1.ext, attachment2.ext  # Путь к файлам вложений, разделенные запятыми. Оставьте пустым, если вложений нет
```

### Шаг 3: Настройка файла с письмом

Создайте файл `letter.txt` в корневой директории проекта или укажите путь к текстовому файлу, содержащему тело письма. Например:

```txt
Текст письма
```

### Шаг 4: Включение пароля приложения для Gmail

1. Перейдите в [аккаунт Google](https://myaccount.google.com/) и выберите раздел **Безопасность**.
2. Включите **двухфакторную аутентификацию** (если еще не включена).
3. В разделе **Пароли приложений** создайте новый пароль для приложения, который будет использоваться в `config.ini`.

## Объяснение кода

### Основные функции и классы

- **`read_config(file_path)`**: Читает конфигурационный файл и возвращает объект `ConfigParser`.
  
- **`SMTPClient`**: Класс для работы с SMTP-сервером.
  - **`__init__(self, server, port, username, password)`**: Инициализация класса с параметрами сервера, порта, имени пользователя и пароля.
  - **`connect(self)`**: Соединяется с SMTP-сервером через SSL.
  - **`_send_command(self, command, expect_code=None)`**: Отправляет команду серверу и получает отклик.
  - **`_get_response(self, expect_code=None)`**: Получает ответ от сервера.
  - **`login(self)`**: Авторизуется на SMTP-сервере.
  - **`send_mail(self, from_addr, to_addrs, subject, body, attachments)`**: Отправляет письмо с заданными параметрами.
  - **`close(self)`**: Закрывает соединение с сервером.

### Пример использования

В `if __name__ == "__main__":`:
1. Считываем конфигурационный файл.
2. Инициализируем объект SMTPClient.
3. Подключаемся и авторизуемся на SMTP-сервере.
4. Отправляем письмо с заданными параметрами.
5. Закрываем соединение.

## Возможные проблемы и решения

### Не удалось соединиться с сервером

Убедитесь, что ваши настройки сервера и порта верны.

### Неверное имя пользователя или пароль

Убедитесь, что вы используете пароль приложения, а не основной пароль от вашего аккаунта Google.

### Не удается найти файл тела или прикрепляемый файл

Убедитесь, что пути к файлам указаны правильно и файлы существуют.

### Общие сети или корпоративные VPN

Некоторые сети блокируют порты SMTP. Попробуйте использовать другое соединение.